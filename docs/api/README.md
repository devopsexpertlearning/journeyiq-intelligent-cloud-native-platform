# API Reference

## Overview
All JourneyIQ services expose RESTful APIs documented via **OpenAPI 3.0** (auto-generated by FastAPI).

## Service Endpoints

### API Gateway
- **Base URL:** `https://api.journeyiq.com`
- **Docs:** `/docs` (Swagger UI)
- **OpenAPI Spec:** `/openapi.json`

### Core Services

| Service | Port | OpenAPI Docs | Purpose |
|---------|------|--------------|---------|
| `auth-service` | 8000 | `/docs` | Authentication & JWT tokens |
| `user-service` | 8000 | `/docs` | User profiles & preferences |
| `inventory-service` | 8000 | `/docs` | Flights, hotels, seats |
| `booking-service` | 8000 | `/docs` | Booking management |
| `payment-service` | 8000 | `/docs` | Payment processing |
| `search-service` | 8000 | `/docs` | Flight/hotel search |
| `ai-agent-service` | 8000 | `/docs` | AI conversational agent |

## Common Patterns

### Authentication
All protected endpoints require JWT token:
```http
Authorization: Bearer <jwt-token>
```

### Health Checks
Every service exposes:
- `GET /health` - Liveness probe
- `GET /ready` - Readiness probe
- `GET /metrics` - Prometheus metrics

### Error Responses
Standard error format:
```json
{
  "detail": "Error message",
  "status_code": 400
}
```

## Example: Booking Flow

### 1. Search Flights
```http
POST /search
Content-Type: application/json

{
  "origin": "SFO",
  "destination": "LAX",
  "date": "2026-02-15",
  "passengers": 2
}
```

### 2. Create Booking
```http
POST /bookings
Authorization: Bearer <token>

{
  "user_id": "usr_123",
  "flight_id": "flt_456",
  "amount": 500.00
}
```

### 3. Process Payment
```http
POST /payments
Authorization: Bearer <token>

{
  "booking_id": "bkg_789",
  "payment_token": "tok_abc"
}
```

## AI Agent API

### Chat Endpoint
```http
POST /agent/chat
Content-Type: application/json

{
  "message": "Find me flights from NYC to Paris",
  "user_id": "usr_123"
}
```

**Response:**
```json
{
  "response": "I found 3 flights...",
  "actions_taken": ["search_flights"],
  "tokens_used": 245
}
```

## Rate Limits
- **Standard:** 100 requests/minute per user
- **AI Agent:** 20 requests/minute (token cost protection)

## Interactive Documentation
Access live API documentation at:
- **Local:** `http://localhost:8000/docs`
- **Prod:** `https://api.journeyiq.com/docs`
